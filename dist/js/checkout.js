(()=>{"use strict";async function t(){try{const t=await fetch("/server/auth_verification.php");if(!t.ok)throw new Error("Network response was not ok");return await t.json()}catch(t){return console.error("Error checking user login:",t),!1}}const e={totalPriceValue:0};document.addEventListener("DOMContentLoaded",(async function(){const n=document.querySelector(".checkout__subtotal"),o=document.querySelector(".checkout__subtotal-value"),c=document.querySelector(".checkout__shipping-value"),r=document.querySelector(".checkout__total-value"),i=document.querySelector(".checkout__country-select"),l=document.querySelectorAll(".checkout__shiping-ua"),a=document.querySelectorAll(".checkout__shiping-pl"),s=document.querySelectorAll(".shipping_method");!function(){const t=document.querySelectorAll(".checkout__blik-input, .checkout__card-input");t&&t.forEach((t=>{t.addEventListener("change",(function(){const t=this.getAttribute("data-description"),e=document.getElementById(t);document.querySelectorAll(".checkout__payment-description").forEach((t=>{t.style.height="0",t.style.opacity="0"})),e&&(e.style.height="calc(var(--index) * 1)",e.style.opacity="1")}))}))}(),await async function(){await async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;function a(t){l&&l.forEach((e=>{if(e.getAttribute("data-id")==t){let t=e.querySelector(".frame__shop-button, .frame__shop-button-left");t.innerHTML="Added!",t.classList.add("added")}}))}await async function(){try{const l=await i();let s=l?l.id:null;const u=await fetch("/server/cart_all_products.php");if(!u.ok)throw new Error("Network response was not ok");(await u.json()).forEach((r=>{if(r.user_id==s){e.totalPriceValue+=parseInt(r.price),a(r.product_id);const i=`\n                        <tr class="products" data-product="${r.product_id}" data-user="${r.user_id}">\n                            <td>\n                                <img class="cart__product-img" src="${r.image}" alt="${r.name}">\n                            </td>\n                            <td>\n                                <ul>\n                                    <li>${r.name}</li>\n                                    <li>${r.description}</li>\n                                    <li>${r.size}</li>\n                                </ul>\n                            </td>\n                            <td class="cart__product__price-value">€${r.price}</td>\n                            <td>\n                                <img class="cart__delete-icon delete-icon" src="/img/delete-icon.webp" alt="delete">\n                            </td>\n                        </tr>`;t&&(t.style.visibility="visible",n.style.visibility="visible",o.style.visibility="visible",c.style.display="none"),n.insertAdjacentHTML("beforebegin",i)}})),r.innerHTML="€"+e.totalPriceValue}catch(t){console.error("Error fetching products:",t)}}(),await async function(){if(!await i()){const i=JSON.parse(localStorage.getItem("localStorArr"))||[];i.length>0&&(i.forEach((r=>{a(r.productId),e.totalPriceValue+=parseInt(r.price);const i=`\n                        <tr class="products" data-product="${r.productId}" data-user="0">\n                            <td>\n                                <img class="cart__product-img" src="${r.image}" alt="${r.name}">\n                            </td>\n                            <td>\n                                <ul>\n                                    <li>${r.name}</li>\n                                    <li>${r.description}</li>\n                                    <li>${r.size}</li>\n                                </ul>\n                            </td>\n                            <td class="cart__product__price-value">€${r.price}</td>\n                            <td>\n                                <img class="cart__delete-icon delete-icon" src="/img/delete-icon.webp" alt="delete">\n                            </td>\n                        </tr>`;t&&(t.style.visibility="visible",n.style.visibility="visible",o.style.visibility="visible",c.style.display="none"),n.insertAdjacentHTML("beforebegin",i)})),r.innerHTML="€"+e.totalPriceValue)}}()}(null,n,null,null,o,t,null),await(200,new Promise((t=>setTimeout(t,200)))),async function(){const t=parseFloat(c?.innerText.replaceAll("€","").trim())||0,e=parseFloat(o?.innerText.replaceAll("€","").trim())||0,n=t+e,u=document.querySelectorAll(".cart__delete-icon"),d=document.querySelectorAll(".products");let p=[];async function y(){const n=e-t;i&&("pl"===i.value&&(r.textContent="€"+n,c.textContent="€00.00",l.forEach((t=>{t.closest(".checkout__input").style.display="none",t.removeAttribute("required")})),a.forEach((t=>{t.closest(".checkout__input").style.display="flex",t.setAttribute("required","")}))),"ua"===i.value&&(r.textContent="€"+n,c.textContent="€00.00",a.forEach((t=>{t.closest(".checkout__input").style.display="none",t.removeAttribute("required")})),l.forEach((t=>{t.closest(".checkout__input").style.display="flex",t.setAttribute("required","")}))))}u.length>0&&u.forEach((t=>{t.style.display="none"})),r.textContent="€"+n,s.forEach((t=>{t.addEventListener("click",(()=>{const n=parseFloat(t.value.match(/[\d.]+/)[0])||0;c.textContent="€"+n;let o=n+e;r.textContent="€"+o}))})),await y(),await async function(){const t=document.getElementById("user_id"),e=document.getElementById("product_id"),n=document.querySelector(".pay");let i;if(d){d.forEach((e=>{const n=e.getAttribute("data-product");t&&(i=e.getAttribute("data-user")),p.push(n)}));let n=p.join(",");t&&(t.setAttribute("value",i),e.setAttribute("value",n))}console.log(p),n&&await async function(){const t={productIds:p};console.log(t);try{const e=await fetch("/server/pay_page.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Network response was not ok: ${e.status}`);const n=await e.json(),i=document.querySelector(".pay__order-id"),l=document.querySelector(".pay__order-date"),a=document.querySelector(".pay__order-payment"),s=document.querySelector(".pay__order-shiping");i.textContent=n[0].id,l.textContent=n[0].date,a.textContent=n[0].payment,s.textContent=n[0].shipping;const u=parseFloat(n[0].shipping.match(/[\d.]+/)[0])||0;c.textContent="€"+u;const d=u+(parseFloat(o?.innerText.replaceAll("€","").trim())||0);r.textContent="€"+d}catch(t){console.error("There was a problem with the fetch operation:",t)}!function(t){const e=JSON.parse(localStorage.getItem("localStorArr"))||[];t.forEach((t=>{e.forEach(((n,o)=>{t===n.productId&&e.splice(o,1)}))})),localStorage.setItem("localStorArr",JSON.stringify(e))}(p)}()}(),i&&i.addEventListener("change",await y)}()}()}))})();